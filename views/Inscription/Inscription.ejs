<%
  // We check if posterror tab exists (in case of previous submit)
  var MainMessageStyleShow = "none";
  var ErrInitStyleShow = ["none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none", "none"];

  if(typeof data_tab == "undefined"){
    data_tab=["","","","","","","","","","","","","","","","","",""];
  }

  if (typeof POSTerror != "undefined")
  {
    if(POSTerror){
      MainMessageStyleShow="inline-block";
    }
  }



  if(typeof posterr != "undefined"){
    for (var i=0;i<=18;i++){
      console.log("test:"+posterr[i]);
      if(posterr[i]=="true"){
        ErrInitStyleShow[i]="inline-block";
      }
    }
  }
%>
<h1>Création d'un compte entreprise</h1>
<p>Créer un compte ne vous engage pas, il permet juste de vous créer un profil sur le site et d'accéder à la partie commande où vous pourrez consulter nos tarifs et passer commande.</p>
<form id="FormInscription" enctype="multipart/form-data" method="post" action="/Company/CreateCompany" class="pure-form pure-form-aligned" >


  <h2>Profil Entreprise</h2>
  <p>Ces informations permettront aux étudiants d'avoir plus d'informations sur votre entreprise lorsqu'ils consulteront le catalogue des entreprises sur le site et dans la plaquette du forum.</p>

    <p style="color:red;font-size:12px;display:<%=MainMessageStyleShow%>" >Veuillez corriger les erreurs dans les champs ci-dessous</p>
    <p style="color:red;font-size:12px;display:<%=MainMessageStyleShow%>" >Les champs marqués d'une étoile sons obligatoires</p>
<fieldset style="text-align: center;">
    <div class="pure-control-group">
      <label for="isPME">Etes-vous une PME?<sup>*</sup> </label>
      <select id="isPME" name="isPME" class="pure-input-1-3" required>
        <option value="false">Non</option>
        <option value="true">Oui</option>
      </select>
    </div>

    <div class="pure-control-group">
      <label for="siret">Numéro de siret<sup>*</sup> </label>
      <input class="pure-input-1-3" maxlength="17" value="<%=data_tab[1]%>" type="text" name="Siret" id="Siret" placeholder="Siret" required  pattern="[0-9]{3}[ \.\-]?[0-9]{3}[ \.\-]?[0-9]{3}[ \.\-]?[0-9]{5}"/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[1]%>" id="siretErr" >Un N° de Siret comporte 14 chiffres (obligatoire)</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyName">Nom de l'entreprise<sup>*</sup> </label>
      <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[2]%>" type="text" name="CompanyName" id="CompanyName" placeholder="Nom de l'entreprise" required/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[2]%>" id="CompanyNameErr" >0&lt;Nb de caractères &lt;50 (obligatoire)</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyGroup">Groupe de l'entreprise </label>
      <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[3]%>" type="text" name="CompanyGroup" id="CompanyGroup" placeholder="Nom du groupe"/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[3]%>" id="CompanyGroupErr" >0&lt;Nb de caractères &lt;50 (obligatoire)</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyDescription">Description de l'entreprise</label>
      <textarea class="pure-input-1-3" rows="3" maxlength="500" value="<%=data_tab[5]%>" name="CompanyDescription" id="CompanyDescription" placeholder="Tapez ici la description de l'entreprise qui apparaitra dans la plaquette du forum et sur le catalogue en ligne."></textarea>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[5]%>" id="CompanyDescriptionErr" >0&lt;Nb de caractères &lt;500 (facultatif pour la création de compte)</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyWebsiteUrl">Site internet officiel</label>
      <input class="pure-input-1-3" maxlength="200" value="<%=data_tab[6]%>" type="url" name="CompanyWebsiteUrl" id="CompanyWebsiteUrl" placeholder="Ex: http://monentreprise.fr"/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[6]%>" id="CompanyWebsiteUrlErr" >Maximum 200 caractères(facultatif)</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyCareerUrl">Site de recrutement</label>
      <input class="pure-input-1-3" maxlength="200" value="<%=data_tab[7]%>" type="url" name="CompanyCareerUrl" id="CompanyCareerUrl" placeholder="Ex: http://monentreprise.fr/recrutement"/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[7]%>" id="CompanyCareerUrlErr" >Maximum 200 caractères</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyAddressRoad">Adresse<sup>*</sup></label>
      <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[8]%>" type="text" name="CompanyAddressRoad" id="CompanyAddressRoad" placeholder="Adresse" required/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[8]%>" id="CompanyAddressRoadErr" >Maximum 50 caractères</p>
    </div>

    <div class="pure-control-group">
      <label for="complementaryInformation">Complément</label>
      <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[9]%>" type="text" name="complementaryInformation" id="complementaryInformation" placeholder="Information complementaire"/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[9]%>" id="complementaryInformationErr" >Maximum 50 caractères</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyAddressPostalCode">Code Postal<sup>*</sup></label>
      <input class="pure-input-1-3" maxlength="6" value="<%=data_tab[10]%>" type="text" name="CompanyPostCode" id="CompanyPostCode" placeholder="Code Postal" required />
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[1]%>" id="CompanyPostCodeErr" >Maximum 6 caractères</p>
    </div>

    <!-- TODO: terminer d'ajouter les <p> pour les erreurs et refondre JScript de sécu client -->

    <div class="pure-control-group">
      <label for="CompanyAddressCity">Ville<sup>*</sup></label>
      <input class="pure-input-1-3" maxlength="200" value="<%=data_tab[11]%>" type="text" name="CompanyAddressCity" id="CompanyAddressCity" placeholder="Ville" required/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[11]%>" id="CompanyAddressCityErr" >Ce champ doit être rempli et contient au maximum 50 caractères</p>
    </div>

    <div class="pure-control-group">
      <label for="CompanyAddressCountry">Pays<sup>*</sup></label>
      <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[12]%>" type="text" name="CompanyAddressCountry" id="CompanyAddressCountry" placeholder="Pays" required/>
      <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[12]%>" id="CompanyAddressCountryErr" > Ce champ doit être rempli et contient au maximum 50 caractères</p>
    </div>

</fieldset>

  <h2>Contact Forum</h2>
  <p>Ces informations doivent être remplies par la personne qui sera en charge du dossier. Elles seront utilisées par l'équipe du forum pour contacter l'entreprise.</p>
<fieldset style="text-align: center;">
  <div class="pure-control-group">
    <label for="UserFirstName">Prénom<sup>*</sup></label>
    <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[13]%>" type="text" name="UserFirstName" id="UserFirstName" placeholder="Prénom" required/>
    <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[13]%>" id="UserFirstNameErr" >Ce champ doit être complété et contenir moins de 20 caractères</p>
  </div>


  <div class="pure-control-group">
    <label for="UserLastName">Nom<sup>*</sup></label>
    <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[14]%>" type="text" name="UserLastName" id="UserLastName" placeholder="Nom" required/>
    <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[14]%>" id="UserLastNameErr" >Ce champ doit être complété et contenir moins de 20 caractères</p>
  </div>

  <div class="pure-control-group">
    <label for="Position">Fonction<sup>*</sup></label>
    <input class="pure-input-1-3" maxlength="50" value="<%=data_tab[15]%>" type="text" name="Position" id="Position" placeholder="Fonction" required/>
    <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[15]%>" id="PositionErr" >Ce champ doit être rempli avec au maximum 50 caractères</p>
  </div>

  <div class="pure-control-group">
    <label for="phoneNumber">Numéro de téléphone<sup>*</sup></label>
    <input class="pure-input-1-3" maxlength="13" value="<%=data_tab[16]%>" type="tel" name="PhoneNumber" id="PhoneNumber" placeholder="Numéro de téléphone" required pattern="^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$"/>
    <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[16]%>" id="PhoneNumberErr" > Ce champ doit être rempli par un numéro de téléphone et contient au maximum 13 caractères</p>
  </div>

  <div class="pure-control-group">
    <label for="UserMail">Addresse e-mail<sup>*</sup></label>
    <input class="pure-input-1-3" maxlength="150" value="<%=data_tab[17]%>" type="email" name="UserEmail" id="UserEmail" placeholder="Email" required pattern="^\S+@(([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6})$"/>
    <p style="color:red;font-size:10px;display:<%=ErrInitStyleShow[17]%>" id="UserEmailErr" > Ce champ doit être rempli et contient au maximum 50 caractères</p>
  </div>

  <div class="pure-control-group">
    <label for="UserPassword">Mot de passe<sup>*</sup></label>
    <input class="pure-input-1-3" minlength="6" maxlength="50" type="password"  id="UserPassword" placeholder="Password" required/>
  </div>

  <div class="pure-control-group">
    <label for="ConfirmUserPassword">Confirmez le mot de passe<sup>*</sup></label>
    <input class="pure-input-1-3" minlength="6" maxlength="50" type="password" id="ConfirmUserPassword" placeholder="Confirm Password" required/><br/>
    <p id="UserPasswordErr" style="color:red;font-size:10px;display:<%=ErrInitStyleShow[18]%>;">Les mots de passe doivent être identiques et contenir entre 6 et 50 carac.</p>
  </div>

</fieldset>


  <h2>Intérêts</h2>
  <p>Quels sont les profils d'étudiants qui vous intéressent ?</p>
  <fieldset style="text-align: center;">

    <table style="border-spacing: 10px; border-collapse: separate">
      <tr>
        <th><input type="checkbox" name="IR" id="IR"/><label for="IR">Informatique et Réseaux</label></th>
        <th><input type="checkbox" name="AE" id="AE"/><label for="AE">Génie Automatique et Électronique</label></th>
        <th><input type="checkbox" name="GP" id="GP"/><label for="GP">Génie Physique</label></th>
        <th><input type="checkbox" name="GB" id="GB"/><label for="GB">Génie Biochimique</label></th>
      </tr>
      <tr>
        <th><input type="checkbox" name="GPE" id="GPE"/><label for="GPE">Génie des Procédés</label></th>
        <th><input type="checkbox" name="GC" id="GC"/><label for="GC">Génie Civil</label></th>
        <th><input type="checkbox" name="GM" id="GM"/><label for="GM">Génie Mécanique</label></th>
        <th><input type="checkbox" name="GMM" id="GMM"/><label for="GMM">Génie Mathématiques et Modélisation</label></th>
      </tr>
    </table>

  <input type="hidden" id="POSTUserPass" name="UserPassword">

  <div class="pure-controls">
    <input id="ButtonSubmit" type="submit" class="pure-button pure-button-primary pure-input-1-3" value="Valider">
  </div>


  </fieldset>
</form>
<p><sup>*</sup> Champs obligatoires</p>

<aside class="announcement">
  <p>
    Vous pouvez créer le compte d'entreprise mais les inscriptions au Forum INSA Entreprises ouvriront Mardi 24 Octobre 2017
  </p>
</aside>

<script type="text/javascript">
  <!--


  // Objets de saisie
  var UserPassword = document.getElementById("UserPassword");
  var ConfirmUserPassword = document.getElementById("ConfirmUserPassword");
  var POSTUserPass = document.getElementById("POSTUserPass");
  var ButtonSubmit = document.getElementById("ButtonSubmit");
  var FormInscription = document.getElementById("FormInscription");

  //Objets de notifications erreurs
  var UserPasswordErr = document.getElementById("UserPasswordErr");

  // On désactive l'envoi du form par défaut
  ButtonSubmit.disabled=true;

  // Fonctions utilisées pour verifier les erreurs

  //Affiche erreur sur un champ
  // ErrObj corespond a l'objet qui contient le message d'erreur (dont le css sera modifié par JS pour qu'il soit affiché)
  function DispError(ErrObj){
    ErrObj.style="display:inline-block;font-size:10px;color:red;";
  }

  // Supprime erreur sur un champ
  // ErrObj corespond a l'objet qui contient le message d'erreur (dont le css sera modifié par JS pour qu'il soit affiché)
  function CleanError(ErrObj){
    ErrObj.style="display:none;";
  }

  // Vérifie que les mots de passes Pass1 et Pass2 soient identiques
  function PassCheck(Pass1,Pass2){
    if(Pass1.value==Pass2.value && Pass1.value.length >= 6 && Pass1.value.length <= 50)
      return true;
  }

  // Verification des mots de passe
  ConfirmUserPassword.addEventListener('input',function(){
    if(PassCheck(UserPassword,ConfirmUserPassword)){
      UserPassword.style="background-color:#66ff66;";
      ConfirmUserPassword.style="background-color:#66ff66;";
      CleanError(UserPasswordErr);
      POSTUserPass.value=sha1(UserPassword.value);
      ButtonSubmit.href="javascript:submitform()";
      ButtonSubmit.disabled=false;
    }
    else
    {
      UserPassword.style="background-color:#ff6666;";
      ConfirmUserPassword.style="background-color:#ff6666;";
      DispError(UserPasswordErr);
      POSTUserPass.value=undefined;
      ButtonSubmit.href="#UserPassword";
      ButtonSubmit.disabled=true;
    }
  })
  UserPassword.addEventListener('input',function(){
    if(PassCheck(UserPassword,ConfirmUserPassword)){
      UserPassword.style="background-color:#66ff66;";
      ConfirmUserPassword.style="background-color:#66ff66;";
      CleanError(UserPasswordErr);
      POSTUserPass.value=sha1(UserPassword.value);
      ButtonSubmit.disabled=false;
    }
    else
    {
      this.style="background-color:#ff6666;";
      ConfirmUserPassword.style="background-color:#ff6666;";
      DispError(UserPasswordErr);
      POSTUserPass.value=undefined;
      ButtonSubmit.href="#UserPassword";
      ButtonSubmit.disabled=true;
    }
  })

  // FOnction qui permet de soumettre le form une fois la verif mot de passe OK
  function submitform()
  {
    FormInscription.submit();
  }

  // Fonction qui permet de faire un hachage en sha1, prise sur le web
  function sha1 (str) {
    //  discuss at: http://phpjs.org/functions/sha1/
    // original by: Webtoolkit.info (http://www.webtoolkit.info/)
    // improved by: Michael White (http://getsprink.com)
    // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    //    input by: Brett Zamir (http://brett-zamir.me)

    var rotate_left = function (n, s) {
      var t4 = (n << s) | (n >>> (32 - s))
      return t4
    }

    /* var lsb_hex = function (val) {
     // Not in use; needed?
     var str="";
     var i;
     var vh;
     var vl;

     for ( i=0; i<=6; i+=2 ) {
     vh = (val>>>(i*4+4))&0x0f;
     vl = (val>>>(i*4))&0x0f;
     str += vh.toString(16) + vl.toString(16);
     }
     return str;
     };*/

    var cvt_hex = function (val) {
      var str = ''
      var i
      var v

      for (i = 7; i >= 0; i--) {
        v = (val >>> (i * 4)) & 0x0f
        str += v.toString(16)
      }
      return str
    }

    var blockstart
    var i, j
    var W = new Array(80)
    var H0 = 0x67452301
    var H1 = 0xEFCDAB89
    var H2 = 0x98BADCFE
    var H3 = 0x10325476
    var H4 = 0xC3D2E1F0
    var A, B, C, D, E
    var temp

    // utf8_encode
    str = unescape(encodeURIComponent(str))
    var str_len = str.length

    var word_array = []
    for (i = 0; i < str_len - 3; i += 4) {
      j = str.charCodeAt(i) << 24 | str.charCodeAt(i + 1) << 16 | str.charCodeAt(i + 2) << 8 | str.charCodeAt(i + 3)
      word_array.push(j)
    }

    switch (str_len % 4) {
      case 0:
        i = 0x080000000
        break
      case 1:
        i = str.charCodeAt(str_len - 1) << 24 | 0x0800000
        break
      case 2:
        i = str.charCodeAt(str_len - 2) << 24 | str.charCodeAt(str_len - 1) << 16 | 0x08000
        break
      case 3:
        i = str.charCodeAt(str_len - 3) << 24 | str.charCodeAt(str_len - 2) << 16 | str.charCodeAt(str_len - 1) <<
          8 | 0x80
        break
    }

    word_array.push(i)

    while ((word_array.length % 16) != 14) {
      word_array.push(0)
    }

    word_array.push(str_len >>> 29)
    word_array.push((str_len << 3) & 0x0ffffffff)

    for (blockstart = 0; blockstart < word_array.length; blockstart += 16) {
      for (i = 0; i < 16; i++) {
        W[i] = word_array[blockstart + i]
      }
      for (i = 16; i <= 79; i++) {
        W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1)
      }

      A = H0
      B = H1
      C = H2
      D = H3
      E = H4

      for (i = 0; i <= 19; i++) {
        temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff
        E = D
        D = C
        C = rotate_left(B, 30)
        B = A
        A = temp
      }

      for (i = 20; i <= 39; i++) {
        temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff
        E = D
        D = C
        C = rotate_left(B, 30)
        B = A
        A = temp
      }

      for (i = 40; i <= 59; i++) {
        temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff
        E = D
        D = C
        C = rotate_left(B, 30)
        B = A
        A = temp
      }

      for (i = 60; i <= 79; i++) {
        temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff
        E = D
        D = C
        C = rotate_left(B, 30)
        B = A
        A = temp
      }

      H0 = (H0 + A) & 0x0ffffffff
      H1 = (H1 + B) & 0x0ffffffff
      H2 = (H2 + C) & 0x0ffffffff
      H3 = (H3 + D) & 0x0ffffffff
      H4 = (H4 + E) & 0x0ffffffff
    }

    temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4)
    return temp.toLowerCase()
  }
  //-->
</script>
